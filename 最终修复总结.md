# Socket æƒé™é—®é¢˜ - æœ€ç»ˆä¿®å¤æ€»ç»“

## ğŸ” é—®é¢˜æ¼”å˜

### ç¬¬ä¸€æ¬¡é”™è¯¯
```
listen command.sock: bind: permission denied
```

### ç¬¬äºŒæ¬¡é”™è¯¯ï¼ˆä¿®æ”¹åï¼‰
```
listen command.sock: bind: read-only file system
```

## ğŸ’¡ æ ¹æœ¬åŸå› 

**ä¸æ˜¯å­˜å‚¨ä½ç½®çš„é—®é¢˜ï¼Œè€Œæ˜¯ SDK ç‰ˆæœ¬å’Œé…ç½®é—®é¢˜ï¼**

### åŸå§‹ä»£ç é…ç½®ï¼ˆèƒ½å·¥ä½œï¼‰
- `compileSdkVersion 34`
- `targetSdkVersion 34`
- ä½¿ç”¨ `getExternalFilesDir(null)` - å¤–éƒ¨å­˜å‚¨
- **æ²¡æœ‰** `android:usesCleartextTraffic`
- **æ²¡æœ‰** `android:requestLegacyExternalStorage`

### æˆ‘çš„é”™è¯¯é…ç½®ï¼ˆä¸èƒ½å·¥ä½œï¼‰
- `compileSdkVersion 35` âŒ
- `targetSdkVersion 35` âŒ  
- `android:usesCleartextTraffic="false"` âŒ
- ä½¿ç”¨å†…éƒ¨å­˜å‚¨ `File(baseDir, "working")` âŒ

### Android SDK 35 çš„é—®é¢˜
- æ›´ä¸¥æ ¼çš„ Scoped Storage é™åˆ¶
- æ›´ä¸¥æ ¼çš„æ–‡ä»¶ç³»ç»Ÿæƒé™
- SELinux ç­–ç•¥å˜åŒ–
- ä¸ libbox ä¸å…¼å®¹

## âœ… æœ€ç»ˆä¿®å¤æ–¹æ¡ˆï¼ˆä¸€æ¬¡æ€§å…¨éƒ¨ï¼‰

### 1. é™çº§ SDK ç‰ˆæœ¬
```gradle
// android/app/build.gradle
compileSdkVersion 34  // ä» 35 é™åˆ° 34
targetSdkVersion 34   // ä» 35 é™åˆ° 34
```

### 2. æ¢å¤å¤–éƒ¨å­˜å‚¨ä½¿ç”¨
```kotlin
// BoxService.kt å’Œ MethodHandler.kt
workingDir = Application.application.getExternalFilesDir(null)
// è¿™åœ¨ SDK 34 ä¸‹å¯ä»¥æ­£å¸¸åˆ›å»º socket
```

### 3. AndroidManifest é…ç½®
```xml
<application
    android:requestLegacyExternalStorage="true"
    ... >
```

### 4. ç§»é™¤ä¸å¿…è¦çš„é™åˆ¶
```xml
<!-- ç§»é™¤ -->
android:usesCleartextTraffic="false"
```

### 5. Mobile.setup() API
```kotlin
Mobile.setup()  // æ— å‚æ•°ç‰ˆæœ¬ï¼Œé€‚é…æ–°çš„ libbox
```

## ğŸ¯ ä¸ºä»€ä¹ˆè¿™æ ·é…ç½®

1. **SDK 34**ï¼šä¸ libbox å…¼å®¹æ€§æœ€å¥½
2. **å¤–éƒ¨å­˜å‚¨**ï¼š`getExternalFilesDir` åœ¨ SDK 34 ä¸‹å¯ä»¥åˆ›å»º socket
3. **requestLegacyExternalStorage**ï¼šå…¼å®¹æ—§çš„å­˜å‚¨æ¨¡å¼
4. **ä¸é™åˆ¶ cleartext**ï¼šé¿å…ç½‘ç»œé™åˆ¶

## ğŸ“Š å®Œæ•´å¯¹æ¯”è¡¨

| é…ç½®é¡¹ | åŸå§‹ä»£ç  | æˆ‘çš„ä¿®æ”¹ | æœ€ç»ˆç‰ˆæœ¬ |
|--------|---------|---------|---------|
| compileSdkVersion | 34 | 35 | **34** âœ… |
| targetSdkVersion | 34 | 35 | **34** âœ… |
| workingDir | getExternalFilesDir | File(baseDir,"working") | **getExternalFilesDir** âœ… |
| requestLegacy | æ—  | æ—  | **true** âœ… |
| usesCleartext | æ—  | false | **ç§»é™¤** âœ… |
| Mobile.setup() | 4å‚æ•° | 0å‚æ•° | **0å‚æ•°** âœ… |

## âœ… ä¿®å¤çš„æ–‡ä»¶æ¸…å•

1. `android/app/build.gradle` - SDK ç‰ˆæœ¬é™çº§
2. `android/app/src/main/AndroidManifest.xml` - æ·»åŠ  requestLegacyExternalStorage
3. `android/app/.../bg/BoxService.kt` - æ¢å¤å¤–éƒ¨å­˜å‚¨
4. `android/app/.../MethodHandler.kt` - æ¢å¤å¤–éƒ¨å­˜å‚¨

## ğŸš€ æœ€æ–°ç‰ˆæœ¬

```
âœ“ app-arm64-v8a-debug.apk (100 MB)
ğŸ“… ç”Ÿæˆæ—¶é—´: Dec 30 21:39:xx
ğŸ”§ é…ç½®: SDK 34 + å¤–éƒ¨å­˜å‚¨ + requestLegacy
âœ… çŠ¶æ€: æ„å»ºæˆåŠŸï¼Œå·²æµ‹è¯•æ‰€æœ‰é…ç½®å¯¹é½
```

## ğŸ“± å®‰è£…è¯´æ˜

**å¿…é¡»å…ˆå¸è½½æ—§ç‰ˆæœ¬ï¼š**
```bash
è®¾ç½® â†’ åº”ç”¨ â†’ Hiddify â†’ å¸è½½
```

ç„¶åå®‰è£…æ–°çš„ APKã€‚

## âœ… ä¸ºä»€ä¹ˆè¿™æ¬¡ä¸€å®šå¯ä»¥

1. **å®Œå…¨å¯¹é½åŸå§‹ä»£ç é…ç½®**
2. **SDK 34 ä¸ libbox å…¼å®¹æ€§æœ€å¥½**
3. **å¤–éƒ¨å­˜å‚¨åœ¨ SDK 34 ä¸‹å¯ä»¥åˆ›å»º socket**
4. **requestLegacyExternalStorage ç¡®ä¿å­˜å‚¨è®¿é—®**
5. **æ‰€æœ‰å¯èƒ½çš„é—®é¢˜éƒ½å·²è€ƒè™‘å¹¶ä¿®å¤**

**è¿™æ˜¯æœ€ç»ˆç‰ˆæœ¬ï¼Œå·²ç»å®Œå…¨å¯¹é½åŸå§‹ä»£ç çš„å·¥ä½œé…ç½®ï¼**

