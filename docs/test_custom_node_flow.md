# 专线节点完整流程测试指南

## 您的配置信息

### Cloudflare 配置
- **Global API Key**: `3c81fa5339019d61bd4f180255fa74b2901e5`
- **邮箱**: `3219904322@qq.com`
- **域名**: 已配置好

### 证书配置
- **证书申请邮箱**: `kdaisywendy@gmail.com`

### XrayR API 配置
- **API 密钥**: `104ac37254d72d6c612e95a5c046780532c30aadd68a4dd999b3d21a79b1ae9d`
- **注意**: 如果您使用"自动设置XrayR"功能，系统会自动生成并配置此密钥，无需手动填写

---

## 测试流程

### 第一步：配置系统设置

1. **登录管理后台**
   - 进入 "系统管理" → "系统设置"
   - 切换到 "专线节点设置" 标签页

2. **填写配置信息**
   ```
   Cloudflare API Key: 3c81fa5339019d61bd4f180255fa74b2901e5
   Cloudflare 邮箱: 3219904322@qq.com
   证书申请邮箱: kdaisywendy@gmail.com
   ```

3. **点击 "保存专线节点设置"**

4. **验证保存**
   - 刷新页面
   - 检查配置是否还在（确认保存成功）

---

### 第二步：测试服务器连接

1. **进入服务器管理**
   - 点击 "用户管理" → "服务器管理"

2. **检查服务器列表**
   - 确认您已添加的VPS服务器在列表中
   - 检查服务器状态

3. **测试连接**
   - 点击服务器行的 "测试连接" 按钮
   - 等待测试完成
   - 确认显示 "连接测试成功"

---

### 第三步：自动安装和配置XrayR

1. **自动设置XrayR**
   - 在服务器列表中，找到要测试的服务器
   - 点击 "自动设置XrayR" 按钮
   - 确认操作提示
   - 等待系统自动完成（可能需要1-2分钟）

2. **检查安装状态**
   - 等待几秒后，刷新页面
   - 检查 "XrayR状态" 列，应该显示 "已安装"

3. **获取XrayR配置**
   - 点击 "获取配置" 按钮
   - 系统会自动读取XrayR配置并填写到系统设置中

4. **验证XrayR配置**
   - 前往 "系统设置" → "专线节点设置"
   - 检查 "XrayR API地址" 和 "XrayR API密钥" 是否已自动填写
   - 记录下这些信息（后续可能需要）

---

### 第四步：创建测试节点

1. **进入专线节点管理**
   - 点击 "用户管理" → "专线节点管理"

2. **创建测试节点**
   - 点击 "创建专线节点" 按钮
   - 填写以下信息：
   
   **基本信息：**
   - 服务器：选择您测试的服务器
   - 节点名称：`测试节点-1`
   - 协议类型：选择 `VMess`（推荐，最简单）

   **连接配置：**
   - 域名：填写您的域名（如果使用域名）
   - 端口：点击 "随机生成" 按钮生成一个端口
   - UUID：点击 "随机生成" 按钮生成UUID
   - 传输协议：选择 `TCP`
   - 安全设置：如果使用域名，选择 `TLS`；否则选择 `None`
   - SNI：如果使用TLS，填写您的域名

   **限制设置：**
   - 流量限制：填写 `10`（10GB，用于测试）
   - 到期时间：留空或设置一个未来日期
   - 遵循用户到期：关闭

3. **保存节点**
   - 点击 "保存" 按钮
   - 系统会显示 "节点创建成功，正在自动搭建..."

4. **等待节点创建完成**
   - 节点创建是异步进行的，需要等待1-3分钟
   - 刷新页面，检查节点状态
   - 状态应该变为 "活跃"

---

### 第五步：验证节点配置

1. **检查节点状态**
   - 在专线节点列表中，找到刚创建的节点
   - 确认状态为 "活跃"
   - 确认激活状态开关为开启

2. **检查XrayR中的节点**
   - SSH连接到服务器
   - 检查XrayR日志：`tail -f /var/log/XrayR/error.log`
   - 确认没有错误信息

3. **检查DNS记录**（如果使用域名）
   - 登录Cloudflare控制台
   - 检查DNS记录是否已创建
   - 确认A记录指向服务器IP

4. **检查证书**（如果使用域名）
   - SSH连接到服务器
   - 检查证书文件：`ls -la /etc/xrayr/cert/`
   - 确认证书文件存在

---

### 第六步：分配节点给测试用户

1. **选择测试用户**
   - 进入 "用户管理" → "用户列表"
   - 选择一个测试用户（或创建一个新用户）

2. **分配节点**
   - 点击用户行的 "详情" 按钮
   - 在用户详情对话框中，切换到 "专线节点分配" 标签页
   - 在 "分配新专线节点" 下拉框中选择刚创建的节点
   - 点击 "分配" 按钮

3. **验证分配**
   - 在 "已分配专线节点" 列表中，应该能看到刚分配的节点
   - 节点名称应该显示为 "专线定制-测试节点-1"

---

### 第七步：测试用户端订阅

1. **获取用户订阅链接**
   - 在用户详情中，找到订阅链接
   - 或让测试用户登录，获取订阅链接

2. **导入订阅到客户端**
   - 使用V2Ray客户端（如V2RayN、Clash等）
   - 导入订阅链接
   - 检查节点列表

3. **验证节点显示**
   - 在客户端中，应该能看到：
     - 普通节点（如果有）
     - 专线节点（名称以 "专线定制-" 开头）

4. **测试连接**
   - 选择专线节点
   - 尝试连接
   - 检查是否能正常使用

---

## 测试检查清单

### 系统设置
- [ ] Cloudflare API Key 已保存
- [ ] Cloudflare 邮箱已保存
- [ ] 证书申请邮箱已保存
- [ ] 刷新后配置仍然存在

### 服务器管理
- [ ] 服务器已添加
- [ ] 服务器连接测试成功
- [ ] XrayR已自动安装
- [ ] XrayR配置已自动获取

### 节点创建
- [ ] 节点创建成功
- [ ] 节点状态为 "活跃"
- [ ] DNS记录已创建（如果使用域名）
- [ ] 证书已申请（如果使用域名）
- [ ] XrayR中节点已创建

### 用户分配
- [ ] 节点已分配给用户
- [ ] 用户订阅中包含专线节点
- [ ] 节点名称正确显示（带 "专线定制-" 前缀）

### 功能测试
- [ ] 节点可以正常连接
- [ ] 流量统计正常
- [ ] 节点配置正确

---

## 常见问题排查

### 问题1：系统设置保存后刷新消失

**检查：**
1. 打开浏览器开发者工具（F12）
2. 查看 Console 标签页，检查是否有错误
3. 查看 Network 标签页，检查保存请求是否成功
4. 检查后端日志

**解决：**
- 确认API请求返回成功
- 检查数据库是否正确保存
- 重新保存设置

### 问题2：XrayR自动安装失败

**检查：**
1. 服务器SSH连接是否正常
2. 服务器是否可以访问外网
3. 查看系统日志获取详细错误

**解决：**
- 使用 "测试连接" 功能确认SSH正常
- 手动SSH到服务器，测试网络连接
- 查看错误日志，根据错误信息解决

### 问题3：节点创建失败

**检查：**
1. 节点状态是否为 "错误"
2. 查看系统日志
3. 检查XrayR服务是否正常运行

**解决：**
- 检查XrayR API配置是否正确
- 确认服务器上的XrayR服务正常运行
- 检查节点配置参数是否正确

### 问题4：证书申请失败

**检查：**
1. Cloudflare API配置是否正确
2. 域名DNS记录是否正确
3. 域名是否已添加到Cloudflare

**解决：**
- 验证Cloudflare API Key是否有效
- 检查DNS记录是否已创建
- 等待DNS传播（可能需要几分钟）

### 问题5：用户订阅中看不到专线节点

**检查：**
1. 节点是否已分配给用户
2. 节点状态是否为 "活跃"
3. 节点是否过期或流量超限

**解决：**
- 确认节点已正确分配
- 检查节点状态和激活状态
- 检查节点流量和到期时间

---

## 测试完成后的操作

1. **清理测试数据**（可选）
   - 删除测试节点
   - 取消节点分配
   - 清理DNS记录（如果使用域名）

2. **记录配置信息**
   - 保存XrayR API地址和密钥
   - 记录节点配置参数
   - 保存重要配置信息

3. **创建正式节点**
   - 使用测试成功的配置
   - 创建正式使用的节点
   - 分配给实际用户

---

## 技术支持

如果测试过程中遇到问题：
1. 查看系统日志
2. 检查浏览器控制台错误
3. 查看服务器日志：`/var/log/XrayR/error.log`
4. 提供详细的错误信息和操作步骤

---

**祝测试顺利！**

