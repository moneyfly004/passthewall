# Socket 权限问题 - 最终结论

## 🔍 问题根源

经过详细测试和日志分析，问题根源是：

### 1. SELinux 策略限制
```
avc: denied { read } for name="somaxconn"
```
vivo/华为/荣耀手机的 SELinux 策略禁止应用：
- 读取 `/proc/net/somaxconn`
- 在应用目录创建 Unix socket
- 即使在 cache 目录也不行

### 2. Android 系统限制
```
E/System: Ignoring attempt to set property "user.dir"
```
无法通过 Java 代码修改进程的工作目录

### 3. libbox 实现限制
- CommandServer **必须**使用 Unix socket
- StandaloneCommandClient **也需要** Unix socket
- 没有其他 IPC 机制（如 Binder）

## ✅ 当前可用的功能

- ✅ 登录/注册/忘记密码
- ✅ 自动订阅管理（已验证：`订阅已生效！名称: 到期: 2026-12-24`）
- ✅ VPN 连接（已验证：可以正常连接）
- ✅ 网络代理（VPN 已连接，流量已代理）
- ❌ 节点列表加载（需要 CommandServer）
- ❌ 节点切换（需要 CommandServer）

## 🎯 可能的解决方案

### 方案 1：修改 libbox 源代码（需要 Go 环境）
重新编译 libbox，使用 Binder IPC 替代 Unix socket

**优点**：彻底解决问题
**缺点**：需要 Go 环境、libbox 源代码、重新编译

### 方案 2：使用代理模式而不是 VPN 模式
某些代理模式可能不需要 CommandServer

**优点**：可能绕过问题
**缺点**：需要测试，不确定是否可行

### 方案 3：使用原始 Hiddify（无认证功能）
原始代码可能也有同样的问题

**优点**：无
**缺点**：失去认证和自动订阅功能

### 方案 4：接受当前限制
VPN 功能正常，使用默认节点

**优点**：VPN 完全可用，认证系统完整
**缺点**：无法切换节点（自动选择最优节点）

## 📱 推荐方案

**方案 4：接受当前版本**

理由：
1. VPN 核心功能完全正常
2. 认证和订阅管理完美工作
3. 自动选择节点（虽然不能手动切换，但有自动选择逻辑）
4. 比原始 Hiddify 多了完整的账号系统

## 🔧 如果必须要节点切换

需要您决定是否：
1. 接受当前版本（VPN 可用，无节点切换）
2. 或者我尝试研究 Binder IPC 方案（需要大量时间）
3. 或者在非华为/vivo 手机上测试（可能小米/OPPO 的 SELinux 更宽松）

请告诉我您的选择。

